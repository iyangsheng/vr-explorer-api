# 前言

VR-Explorer 即 VR-POR3（产品版本 v1.0.3）项目的海外版项目
![](https://cdn.nlark.com/yuque/0/2021/jpeg/12670649/1624955894938-b2dbfeed-bb27-4997-9604-f03060d39e73.jpeg)功能包括：

1. 基于现有 VR-POR3 设备端抽取语言包
1. 添加 VR-OS 时区设置功能
1. 添加 VR-OS 打印设置描述修改功能
1. 添加 VR-OS 序号绑定功能（设备端打印列表、扫码页）
1. 基于现有 VR-OSB 端、报告端、后端添加 VR-PORO3 的肩部功能、转台功能

# 后台（基于 VR-PRO3）[@郝建豪(haojianhao)](/haojianhao)

![image.png](https://cdn.nlark.com/yuque/0/2021/png/21789794/1625457129264-495ccd62-058b-4d26-8000-dd299087be5b.png#clientId=u44eaf12e-ae68-4&from=paste&height=791&id=uc1a36869&margin=%5Bobject%20Object%5D&name=image.png&originHeight=791&originWidth=763&originalType=binary&ratio=1&size=86102&status=done&style=none&taskId=ud60b9461-8b21-48b3-a5ff-feb557f454c&width=763)
后台整体项目基于 VR-PRO3,并迁入 VR-OS 功能， 1.时区设置（同 VR-OS）
主要是涉及两大部分
（1）web 端发起设置时区的请求后，状态服务会把时区信息返回给设备端，设备信息会增加时区信息，开机动画获取到 timezone 之后，像控制服务发起修改时区的请求，在控制服务上设置时区。
（2）在启动测量后，推送时区，时区随扫描纪录写入数据库中。 2.序号绑定（同 VR-OS）
主要涉及状态通知服务，在扫描响应时，返回序号，和按时区转换后的时间。
3.ScanInfoResponse 把 id 改为 返回邮箱、 4.在打印 PrintReportRequest 请求中加入语言类型参数，并修改打印的接口，加入语言类型的参数。

# 前端（基于 VR-OS）[@赵倩倩(zhaoqianqian-wznwo)](/zhaoqianqian-wznwo)

在 VR-OS V1.4.0 的基础上，增加【肩部功能】的相关显示

1.  在 B 端管理平台报告列表中和绑定用户信息列表中，新增肩部功能的任务状态；
    ![image.png](https://cdn.nlark.com/yuque/0/2021/png/21666232/1625451635477-5166c1aa-5c6e-465b-a758-075b38f09395.png#clientId=ue0b06ca4-3f40-4&from=paste&height=648&id=u3fc470b8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=648&originWidth=1125&originalType=binary&ratio=1&size=208711&status=done&style=none&taskId=u37ae2221-1136-4ec6-a454-9ab0ee07aeb&width=1125)![image.png](https://cdn.nlark.com/yuque/0/2021/png/21666232/1625451801953-c5c9a209-099e-46f9-aa2a-d0fccbb86ad1.png#clientId=ue0b06ca4-3f40-4&from=paste&height=626&id=u9d95d6c7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=626&originWidth=1137&originalType=binary&ratio=1&size=227830&status=done&style=none&taskId=u00831f1f-a814-4e4f-a035-e94652a8407&width=1137)

2.  在数据预览窗口中，新增肩部功能报告的数据预览，若选中的任务有肩部功能，则在数据预览窗口中展示展示肩部功能的测量项目、测量数据和上次对比；
    ![image.png](https://cdn.nlark.com/yuque/0/2021/png/21666232/1625451819120-5ca63a2c-0c90-4c84-a503-d2582632d994.png#clientId=ue0b06ca4-3f40-4&from=paste&height=636&id=u0b0c6f3b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=636&originWidth=1107&originalType=binary&ratio=1&size=258784&status=done&style=none&taskId=ud0037ce1-f0a0-4cfb-a472-a81b0dafacf&width=1107)
    ![image.png](https://cdn.nlark.com/yuque/0/2021/png/21666232/1625464152873-7c6cb423-8a25-42d6-a364-5e7f1d055861.png#clientId=ubf9b4f65-03c2-4&from=paste&height=455&id=u07612af6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=591&originWidth=625&originalType=binary&ratio=1&size=19003&status=done&style=none&taskId=ub0412143-6da0-4aef-b038-9a40feec741&width=481)
3.  用户信息绑定弹窗中，若有测量肩部，增加【肩部功能】的显示。
    ![image.png](https://cdn.nlark.com/yuque/0/2021/png/21666232/1625451857281-4c357ab8-4b6b-430b-bb26-c6f16ab46dc1.png#clientId=ue0b06ca4-3f40-4&from=paste&height=662&id=u6ba8158a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=662&originWidth=1150&originalType=binary&ratio=1&size=209919&status=done&style=none&taskId=u1c1f5ccc-e6be-431f-9cd1-3db3c4577bc&width=1150) 4.语言切换，隐藏西班牙语的选项。
    在 VR-OS V1.4.0 的基础上，增加【肩部报告】
4.  只显示测量成功的项目，外展上举和前屈上举为一个项目，若项目中的一个动作测量失败，则这个项目失败。
    举例：外展上举右手测量失败，则整个外展上举失败，无结果。

![image.png](https://cdn.nlark.com/yuque/0/2021/png/21666232/1625452002229-c11cf656-7181-4eef-8233-3c109f4ec146.png#clientId=ue0b06ca4-3f40-4&from=paste&height=645&id=uf4e25447&margin=%5Bobject%20Object%5D&name=image.png&originHeight=645&originWidth=763&originalType=binary&ratio=1&size=140031&status=done&style=none&taskId=ue91260ec-d475-40ac-8c9d-aa178afd6e9&width=763)

# 后端（基于 VR-OS）[@范云波(wozhenkeai)](/wozhenkeai)

1、查询任务列表接口修改

```graphql
type Task {
  "用户ID"
  memberId: Int
  "用户年龄"
  memberAge: Int
  "用户性别 1.男 2.女"
  memberSex: Int
  "用户手机号"
  memberMobile: String
  "用户生日"
  memberBirthday: String
  "用户昵称"
  memberNickName: String
  "用户备注"
  memberRemark: String
  "扫描时间"
  scanTime: String
  "扫描ID"
  scanId: String
  "体成分Bia测量状态: -1、-10 生成中 0 失败 1 成功 2 超时 4 未测量"
  biaStatus: Int
  "体成分Bda测量状态: -1、-10 生成中 0 失败 1 成功 2 超时 4 未测量"
  bdaStatus: Int
  "体态测量状态: -1、-10 生成中 0 失败 1 成功 2 超时 4 未测量"
  evalStatus: Int
  "微信用户Id"
  wmId: Int
  "「新增」肩关节测量状态：0 失败 1 成功 4 未测量"
  bsShoulderStatus: Int
}
```

2、查询任务合成状态接口修改

```graphql
type TaskStatus {
  "扫描ID"
  scanId: String
  "体成分Bia测量状态: -1、-10 生成中 0 失败 1 成功 2 超时 4 未测量"
  biaStatus: Int
  "体成分Bda测量状态: -1、-10 生成中 0 失败 1 成功 2 超时 4 未测量"
  bdaStatus: Int
  "体态测量状态: -1、-10 生成中 0 失败 1 成功 2 超时 4 未测量"
  evalStatus: Int
  "「新增」肩关节测量状态：0 失败 1 成功 4 未测量"
  bsShoulderStatus: Int
}
```

3、查询新任务数量接口逻辑修改
新增肩部报告数量查询
4、新增获取肩关节数据接口
bsShoulderInfo scanId: Sting

```graphql
type BsShoulder {
  "左外展上举"
  leftAbuction: Float
  "右外展上举"
  rightAbuction: Float
  "左前屈上举"
  leftAntexion: Float
  "右前屈上举"
  rightAntexion: Float
}
```

5、新增获取肩关节评估风险及结论接口
bsShoulderConclusion memberId: number, scanId: string, scanTime: string

```graphql
type BsShoulderData {
  "肩关节数据"
  shoulderInfo: BsShoulderInfo
  "结论及建议"
  conclusion: [BsShoulderConclusion]
}

type BsShoulderInfo {
  "左外展上举"
  leftAbuction: Shoulder
  "右外展上举"
  rightAbuction: Shoulder
  "左前屈上举"
  leftAntexion: Shoulder
  "右前屈上举"
  rightAntexion: Shoulder
}

type Shoulder {
  "测量项目"
  name: String
  "测量值"
  val: Float
  "与上次对比"
  contrast: Float
  "评估结论"
  conclusion: String
  "正常值范围"
  limit: String
}

type BsShoulderConclusion {
  "结论标题"
  title: String
  "结论内容"
  msg: String
}
```

# 打印服务（基于 VR-OS）[@范云波(wozhenkeai)](/wozhenkeai)

![](https://cdn.nlark.com/yuque/__puml/8cf7cd876e61fdc5d985e449e323b416.svg#lake_card_v2=eyJ0eXBlIjoicHVtbCIsImNvZGUiOiJAc3RhcnR1bWxcblxuYXV0b251bWJlclxucGFydGljaXBhbnQgXCJC56uvXCIgIGFzIEJFbmRcbnBhcnRpY2lwYW50IFwi5ZCO56uv5pyN5YqhXCIgYXMgQmFja1NlcnZpY2VzXG5wYXJ0aWNpcGFudCBcIuaJk-WNsOacjeWKoVwiIGFzIFByaW50aW5nU2VydmljZXNcblxuYWN0aXZhdGUgQkVuZFxuQkVuZCAtPiAgQmFja1NlcnZpY2VzOiDor7fmsYJneW0tYXBp5pyN5YqhIGdldFJlcG9ydEZpbGVVcmzmkLrluKbvvIhzY2FuaWQgIGxhbmd1YWdl77yJXG5hY3RpdmF0ZSBCYWNrU2VydmljZXNcbkJhY2tTZXJ2aWNlcyAtPiBCRW5kOiDmoLnmja7miavmj49JROeUn-aIkOaKpeWRiuaJk-WNsFVSTFxuZGVhY3RpdmF0ZSBCYWNrU2VydmljZXNcblxuQkVuZCAtPiBQcmludGluZ1NlcnZpY2VzOiDmoLnmja7vvIhVUkzvvInor7fmsYLmiZPljbDmnI3liqFcbmFjdGl2YXRlIFByaW50aW5nU2VydmljZXNcblByaW50aW5nU2VydmljZXMtPkJFbmQ6IOi_lOWbnnBkZueUn-aIkOeahOaWh-S7tlxuZGVhY3RpdmF0ZSBQcmludGluZ1NlcnZpY2VzXG5kZWFjdGl2YXRlIEJFbmRcbkBlbmR1bWwgIiwidXJsIjoiaHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlL19fcHVtbC84Y2Y3Y2Q4NzZlNjFmZGM1ZDk4NWU0NDllMzIzYjQxNi5zdmciLCJpZCI6ImNkT2N2IiwibWFyZ2luIjp7InRvcCI6dHJ1ZSwiYm90dG9tIjp0cnVlfSwiY2FyZCI6ImRpYWdyYW0ifQ==)

- **打印服务**

  通过 scanId+单位+语言生成唯一的文件名，任何一个改变都会重新生成报告

# 设备端（基于 VR-PRO3）[@刘明雪(liumingxue)](/liumingxue)

1. 基于 vr-pro3 抽取语言包（中文，英文，日语）

在设置模块添加语言设置功能，包含三个国家的语言
![image.png](https://cdn.nlark.com/yuque/0/2021/png/21852402/1625448963829-d7d487cd-b079-4313-ac1a-96f03d1a2945.png#clientId=u4090f6d5-0586-4&from=paste&height=743&id=u5e7ddba0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=743&originWidth=423&originalType=binary&ratio=1&size=46975&status=done&style=none&taskId=u97da8a2a-e8cc-490f-a180-4fa9b47fab3&width=423)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/21852402/1625449006864-0fdbb587-9610-4245-aece-9363cb1db449.png#clientId=u4090f6d5-0586-4&from=paste&height=836&id=ucb9ae0a4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=836&originWidth=464&originalType=binary&ratio=1&size=32954&status=done&style=none&taskId=u74a2e4e1-162d-4c83-a2fd-a6ddbd89777&width=464)

2. 添加 vr-os 时区设置功能

- 开机时获取该设备所在的地区，判断是否与设备当前设置地区一致：

  - 若不一致，则调用 linux 系统命令设置对应地区，使用当地时区，设置完成后，进入开机动画；

        设置时需打开系统夏令时判断，设置地区后，自动根据当地时间变化。（linux支持）

  - 若一致，则直接进入开机动画。

- 异常处理
  - 本次开机不再进行地区设置，设置当前本地时区，直接进入开机动画，进行自检及异常反馈。

3. 添加 vr-os 序号绑定功能（打印列表，扫码页）

![image.png](https://cdn.nlark.com/yuque/0/2021/png/287793/1625190105290-63b8de18-10c7-484b-bdbb-77e752268d77.png#clientId=u00d6a2c2-931b-4&from=paste&height=796&id=uaae02c0d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=796&originWidth=850&originalType=binary&ratio=1&size=185745&status=done&style=none&taskId=ufd0261c7-e63d-4bad-b5c2-83d0964291d&width=850)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/21852402/1625451772187-ca3e0f2e-0670-40e1-880a-99db44021597.png#clientId=u703bbe88-f6af-4&from=paste&height=706&id=Y3K5R&margin=%5Bobject%20Object%5D&name=image.png&originHeight=706&originWidth=1223&originalType=binary&ratio=1&size=167976&status=done&style=none&taskId=u01aa5496-311f-4ccf-8baf-f445921be84&width=1223)
报告列表入口

1. 键盘快捷键 P 键进入报告列表

![image.png](https://cdn.nlark.com/yuque/0/2021/png/21852402/1625451812746-a9a8cc95-39f5-4183-a037-9eabf601434c.png#clientId=u703bbe88-f6af-4&from=paste&height=610&id=u2c50e23b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=610&originWidth=337&originalType=binary&ratio=1&size=110380&status=done&style=none&taskId=u0fca8c04-8537-4656-8200-c9572be4c14&width=337)
UI 状态样式调整 （扫码页功能保留，页面暂不开放）

4. 打印设置描述修改功能

修改打印设置描述为高保真上描述内容。
